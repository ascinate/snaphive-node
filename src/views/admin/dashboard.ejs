<%- include("../components/adminHeader", { title: title }) %>

    <%- include("../components/adminSidebar") %>
        <!--begin::App Main-->
        <main class="app-main">
            <!--begin::App Content Header-->
            <div class="app-content-header">
                <!--begin::Container-->
                <div class="container-fluid">
                    <!--begin::Row-->
                    <div class="row">
                        <div class="col-sm-6">
                            <h3 class="mb-0">Dashboard</h3>
                        </div>

                    </div>
                </div>
            </div>
            <div class="app-content">
                <div class="container-fluid">
                    <div class="row g-3 mb-4">

                        <!-- ROW 1 – USERS -->
                        <div class="col-lg-3 col-6">
                            <div class="card text-white position-relative"
                                style="background:#007bff;border-radius:10px">
                                <div class="card-body">
                                    <h3>
                                        <%= stats.totalUsers %>
                                    </h3>
                                    <p class="mb-0">Total Users</p>
                                    <i
                                        class="bi bi-people fs-1 opacity-25 position-absolute top-50 end-0 translate-middle-y me-3"></i>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-3 col-6">
                            <div class="card text-white position-relative"
                                style="background:#28a745;border-radius:10px">
                                <div class="card-body">
                                    <h3>
                                        <%= stats.dailyActiveUsers %>
                                    </h3>
                                    <p class="mb-0">Daily Active Users</p>
                                    <i
                                        class="bi bi-calendar-day fs-1 opacity-25 position-absolute top-50 end-0 translate-middle-y me-3"></i>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-3 col-6">
                            <div class="card text-white position-relative"
                                style="background:#17a2b8;border-radius:10px">
                                <div class="card-body">
                                    <h3>
                                        <%= stats.monthlyActiveUsers %>
                                    </h3>
                                    <p class="mb-0">Monthly Active Users</p>
                                    <i
                                        class="bi bi-calendar-month fs-1 opacity-25 position-absolute top-50 end-0 translate-middle-y me-3"></i>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-3 col-6">
                            <div class="card text-dark position-relative" style="background:#ffc107;border-radius:10px">
                                <div class="card-body">
                                    <h3>
                                        <%= stats.autoSyncRate %>%
                                    </h3>
                                    <p class="mb-0">Auto Sync Usage</p>
                                    <i
                                        class="bi bi-arrow-repeat fs-1 opacity-25 position-absolute top-50 end-0 translate-middle-y me-3"></i>
                                </div>
                            </div>
                        </div>

                        <!-- ROW 2 – HIVES -->
                        <div class="col-lg-6 col-6">
                            <div class="card text-white position-relative"
                                style="background:#6f42c1;border-radius:10px">
                                <div class="card-body">
                                    <h3>
                                        <%= stats.totalHives %>
                                    </h3>
                                    <p class="mb-0">Total Hives</p>
                                    <i
                                        class="bi bi-hive fs-1 opacity-25 position-absolute top-50 end-0 translate-middle-y me-3"></i>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6 col-6">
                            <div class="card text-white position-relative"
                                style="background:#20c997;border-radius:10px">
                                <div class="card-body">
                                    <h3>
                                        <%= stats.hivesToday %>
                                    </h3>
                                    <p class="mb-0">Hives Created Today</p>
                                    <i
                                        class="bi bi-plus-circle fs-1 opacity-25 position-absolute top-50 end-0 translate-middle-y me-3"></i>
                                </div>
                            </div>
                        </div>

                        <!-- ROW 3 – MEDIA -->
                        <div class="col-lg-6 col-6">
                            <div class="card text-white position-relative"
                                style="background:#343a40;border-radius:10px">
                                <div class="card-body">
                                    <h3>
                                        <%= stats.totalPhotos %>
                                    </h3>
                                    <p class="mb-0">Total Photos Uploaded</p>
                                    <i
                                        class="bi bi-images fs-1 opacity-25 position-absolute top-50 end-0 translate-middle-y me-3"></i>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6 col-6">
                            <div class="card text-white position-relative"
                                style="background:#fd7e14;border-radius:10px">
                                <div class="card-body">
                                    <h3>
                                        <%= stats.storageUsedGB %> GB
                                    </h3>
                                    <p class="mb-0">Storage Usage</p>
                                    <i
                                        class="bi bi-hdd fs-1 opacity-25 position-absolute top-50 end-0 translate-middle-y me-3"></i>
                                </div>
                            </div>
                        </div>

                    </div>




                    <!--end::Row-->
                    <!--begin::Row-->
                    <!-- Include ApexCharts -->
                    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

                    <div class="row g-3">
                        <!-- ======= TOP ROW ======= -->

                        <!-- Engagement Trend -->
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Engagement Trend (DAU / WAU / MAU)</h5>
                                </div>
                                <div class="card-body">
                                    <div id="engagementTrend"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Feature Adoption -->
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Feature Adoption (Stacked)</h5>
                                </div>
                                <div class="card-body">
                                    <div id="featureAdoption"></div>
                                </div>
                            </div>
                        </div>

                        <!-- ======= BOTTOM ROW ======= -->
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Partner Digest Opens (by Weekday)</h5>
                                </div>
                                <div class="card-body">
                                    <div id="partnerOpens"></div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">AI Model Health</h5>
                                </div>
                                <div class="card-body">
                                    <div id="aiModelHealth"></div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Content Verification Heatmap</h5>
                                </div>
                                <div class="card-body">
                                    <div id="contentVerification"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <script>
                        // ============ ENGAGEMENT TREND (Line) ============
                        var engagementOptions = {
                            chart: {
                                type: 'line',
                                height: 280,
                                toolbar: { show: false }
                            },
                            series: [
                                { name: 'DAU', data: [320, 410, 380, 470, 520, 610, 680] },
                                { name: 'WAU', data: [1250, 1320, 1450, 1500, 1600, 1720, 1800] },
                                { name: 'MAU', data: [4500, 4700, 4800, 4900, 5100, 5300, 5500] }
                            ],
                            xaxis: {
                                categories: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
                            },
                            colors: ['#007bff', '#28a745', '#ffc107'],
                            stroke: { width: 3, curve: 'smooth' },
                            markers: { size: 4 },
                            tooltip: { shared: true, intersect: false }
                        };
                        new ApexCharts(document.querySelector("#engagementTrend"), engagementOptions).render();

                        var adoptionOptions = {
                            chart: {
                                type: 'bar',
                                stacked: true,
                                height: 280,
                                toolbar: { show: false }
                            },
                            series: [
                                { name: 'Mood Logs', data: [30, 40, 35, 50, 49, 60, 70] },
                                { name: 'Recipe Views', data: [20, 30, 25, 35, 40, 45, 50] },
                                { name: 'Workouts', data: [15, 20, 18, 25, 30, 35, 40] },
                                { name: 'Meditations', data: [10, 15, 12, 18, 20, 22, 25] },
                                { name: 'Community Posts', data: [5, 10, 8, 12, 14, 16, 18] }
                            ],
                            xaxis: { categories: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'] },
                            colors: ['#007bff', '#17a2b8', '#28a745', '#ffc107', '#dc3545'],
                            legend: { position: 'bottom' }
                        };
                        new ApexCharts(document.querySelector("#featureAdoption"), adoptionOptions).render();


                        // ============ PARTNER DIGEST OPENS (Sparkline Heatmap) ============
                        var partnerOptions = {
                            chart: {
                                type: 'heatmap',
                                height: 280,
                                toolbar: { show: false }
                            },
                            dataLabels: { enabled: false },
                            colors: ["#0d6efd"],
                            series: [
                                { name: 'Mon', data: genRandom(24) },
                                { name: 'Tue', data: genRandom(24) },
                                { name: 'Wed', data: genRandom(24) },
                                { name: 'Thu', data: genRandom(24) },
                                { name: 'Fri', data: genRandom(24) },
                                { name: 'Sat', data: genRandom(24) },
                                { name: 'Sun', data: genRandom(24) }
                            ],
                            xaxis: { categories: Array.from({ length: 24 }, (_, i) => i + ":00") },
                            title: { text: '' }
                        };
                        function genRandom(count) {
                            return Array.from({ length: count }, () => Math.floor(Math.random() * 90));
                        }
                        new ApexCharts(document.querySelector("#partnerOpens"), partnerOptions).render();


                        // ============ AI MODEL HEALTH (Mixed chart) ============
                        var aiOptions = {
                            chart: {
                                height: 280,
                                type: 'line',
                                stacked: false
                            },
                            series: [
                                { name: "Requests/min", type: 'column', data: [100, 150, 130, 180, 200, 210, 190] },
                                { name: "Avg Latency (ms)", type: 'line', data: [220, 200, 230, 210, 250, 240, 230] },
                                { name: "Error Rate %", type: 'line', data: [1.2, 0.8, 1.5, 1.1, 1.3, 0.9, 1.0] }
                            ],
                            colors: ['#007bff', '#ffc107', '#dc3545'],
                            stroke: { width: [0, 3, 3], curve: 'smooth' },
                            xaxis: { categories: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'] },
                            yaxis: [
                                { title: { text: 'Requests/min' } },
                                { opposite: true, title: { text: 'Latency / Error %' } }
                            ],
                            legend: { position: 'bottom' }
                        };
                        new ApexCharts(document.querySelector("#aiModelHealth"), aiOptions).render();


                        // ============ CONTENT VERIFICATION HEATMAP ============
                        var contentOptions = {
                            chart: {
                                type: 'heatmap',
                                height: 280,
                                toolbar: { show: false }
                            },
                            dataLabels: { enabled: false },
                            colors: ["#28a745"],
                            series: [
                                { name: 'Recipes', data: [80, 20] },
                                { name: 'Courses', data: [70, 30] },
                                { name: 'Workouts', data: [85, 15] },
                                { name: 'Articles', data: [90, 10] },
                                { name: 'Tips', data: [65, 35] }
                            ],
                            xaxis: { categories: ['Verified', 'Unverified'] }
                        };
                        new ApexCharts(document.querySelector("#contentVerification"), contentOptions).render();
                    </script>

                    <!-- /.row (main row) -->
                </div>
                <!--end::Container-->
            </div>
            <!--end::App Content-->
        </main>
        <!--end::App Main-->
        <%- include("../components/adminFooter") %>